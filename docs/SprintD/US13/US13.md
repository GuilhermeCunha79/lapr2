# US 13 - To consult the historical tests performed by a particular client and to be able to check tests details/results.

## 1. Requirements Engineering


### 1.1. User Story Description


As a clinical chemistry technologist, I intend to consult the historical tests performed by a particular client and to be able to check tests details/results.


### 1.2. Customer Specifications and Clarifications 


**From the specifications document:**

> " (...) At the same time the results are also available in the central application where the medical lab technicians
who collect the samples, the clinical chemistry technologist, the specialist doctor, and the laboratory
coordinator can check them.
To facilitate the access to the results, the application must allow ordering the clients by TIF and by
name. The ordering algorithm to be used by the application must be defined through a configuration
file. It is intended that the choice of the ordering algorithm is based on the algorithm complexity
(mainly the execution time). Therefore, at least two sorting algorithms should be evaluated and
documented in the application user manual (in the annexes) that must be delivered with the
application."




**From the client clarifications:**

> **Question:** From the user story description "As a clinical chemistry technologist, I intend to consult the historical tests performed by a particular client and to be able to check tests details/results". What do you mean by "check tests details/results" ?
> 
> **Answer:** A: The clinical chemistry technologist should be able to check the historical tests performed by a particular client and see the results obtained in each test. For a given client (that was selected by the clinical chemistry technologist) the application should show all tests performed by the client and, for each parameter, the application should show the parameter value and the parameter reference values. The clinical chemistry technologist should not have access to the report made by the specialist doctor.



### 1.3. Acceptance Criteria

* **AC1:** The application must allow ordering the clients by TIN and
  by name to help the clinical chemistry technologist choose the target client. The
  ordering algorithm to be used by the application must be defined through a
  configuration file. At least two sorting algorithms should be available.
* **AC2:** 


### 1.4. Found out Dependencies

* This US has a dependency with the US03, US

### 1.5 Input and Output Data


**Input Data:**

* Typed data:
	
	
* Selected data:


**Output Data:**

* (In)Success of the operation

### 1.6. System Sequence Diagram (SSD)

![US13_SSD](US13_SSD.svg)


### 1.7 Other Relevant Remarks


## 2. OO Analysis

### 2.1. Relevant Domain Model Except 

![US13_MD](US13_MD.svg)

### 2.2. Other Remarks

n/a


## 3. Design - User Story Realization 

### 3.1. Rationale



| Interaction ID | Question: Which class is responsible for... | Answer  | Justification (with patterns)  |
|:-------------  |:--------------------- |:------------|:---------------------------- |
| Step 1 | ...interacting with the user? | WriteReportUI | Pure Fabrication: There are no reasons to assign this task to any class of the domain |
| | ...managing the US? | WriteReportController | Controller: The controller is responsible to make the bridge between UI layer and Domain Layer |
| Step 2 | | | |
| Step 3 | ...send data from UI to Domain? | WriteReportController | Controller |
| | ...transform list of tests to a DTO? | TestListMapper | DTO: Used to transfer data from domain to UI and vice-versa, and reduce coupling between these layers |
| | ...present tests that need a report? | WriteReportUI | Pure Fabrication: There are no reasons to assign this task to any class of the domain |
| | ...giving all tests without report done? | TestStore | Creator and HC+LC: to remove this responsibility from the Company and apply HC+LC |
| | ...knows the TestStore? | Company | IE: Company knows all its stores |
| | ...knowing test data? | Test | IE: Each test knows its own data |
| | ...knowing the results for each parameter testes? | TestParameterResult | IE: each parameter result knows its own data |
| Step 4 | | | |
| Step 5 | ...storing the reports? | Test | Creator: Test will store its own reports and is also responsible for instantiating a new report |
| Step 6 | | | |
| Step 7 | ...validating the written report? | Report | IE: knows its own data and also knows each acceptance criteria |
| | ...knowing the current date and time? | DateTime | Pure Fabrication: there is no need to assign this responsibility to any domain class |
| | ...registering validation date and time? | Report | IE: saves its own data |
| Step 8 | ...informing success of the operation? | WriteReportUI | It's always responsible for user interaction |


### Systematization ##

According to the taken rationale, the conceptual classes promoted to software classes are: 

 - Company
 - Report
 - Test
 - TestParameterResult

Other software classes (i.e. Pure Fabrication) identified: 

 - WriteReportUI
 - WriteReportController
 - TestStore
 - TestListMapper
 - DateTime

## 3.2. Sequence Diagram (SD)


![US13_SD](US13_SD.svg)


## 3.3. Class Diagram (CD)


![US13_CD](US13_CD.svg)

# 4. Tests 

	@Test(expected = NullPointerException.class)
    public void ensureItsNotPossibleToAddNullReportText(){
        new Report(null);
    }

    @Test(expected = IllegalArgumentException.class)
    public void ensureItsNotPossibleToAddBlankReportText(){
        new Report("");
    }

    @Test(expected = IllegalArgumentException.class)
    public void ensureItsNotPossibleToAddReportTextWithMoreThan400words(){
        new Report("a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f" +
                "a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f" +
                "a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f" +
                "a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f" +
                "a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f" +
                "a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f a b b d a a f d a d f a f d a d f d a d f a d f a d f a d f a d f" +
                "a b b d a a g g g g f");
    }

# 5. Construction (Implementation)

* Controller

  
  		public List<String> getTestWithoutReport(){
  			List<CATest> lTestNoReport = testStore.getTestWithoutReport();
  			if(lTestNoReport != null) {
  			TestListMapper tlm = new TestListMapper();
  			return tlm.toDto(lTestNoReport);
  			}
  			return null;
  		}

	  	public String getTestResults(String testCode){
	  		this.test = testStore.getTestByCode(testCode);
	  		return test.getTestResults();
	  	}

	  	public void newReport(String text){
	  		this.report = new Report(text);
	  	}

		public boolean saveReport(){
			return this.test.addReport(this.report);
		}

* Report

  
		public Report (String reportText){
			setReportText(reportText);
		}

    
    	public String getReportText() {
        	return reportText;
   		}

    
    	public DateTime getCreatedAt() {
        	return createdAt;
    	}

  		public void setReportText(String reportText) {
        	if(reportText == null)
            	throw new NullPointerException();
        	if(StringUtils.isBlank(reportText))
            	throw new IllegalArgumentException("Report cannot be empty");
        	if(CommonMethods.wordCounter(reportText) > MAX_WORDS_IN_REPORT)
            	throw new IllegalArgumentException("Report cannot have more than " + MAX_WORDS_IN_REPORT + "words.");
        	this.reportText = reportText;
        	registerReportDateTime();
    	}

    
  		public void registerReportDateTime(){
        	this.createdAt = new DateTime();
    	}
	
# 6. Integration and Demo 


# 7. Observations







