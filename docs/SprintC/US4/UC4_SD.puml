
@startuml
autonumber
actor "Receptionist" as REC

participant ":CreateTestUI" as UI
participant ":CreateTestController" as CTRL
participant "comp\n:Company" as COMP

participant "testStore: TestStore" as TSTORE

participant "store: ClientStore" as CSTORE

participant "clinicalAnalysisLaboratoryDTO: ClinicalAnalysisLaboratoryDTO" as CALDTO
participant "ClinicalAnalysisLaboratoryStore" as CALS

participant "testTypeStore: TypeOfTestStore" as TTSTORE

participant "test\n:Test" as TEST
participant "testDto: TestDto" as TDTO

participant "testTypeMap:TestTypeMapper" as TMAPPER

participant "parameterMap:ParameterMapper" as PMAPPER
participant "storeParameter: ParameterStore" as PSTORE

activate REC
REC -> UI : Creation of a new test
activate UI
UI --> REC :Asks to select a registered client from the list
deactivate UI
REC -> UI : Selects one client
activate UI
UI -> CTRL : addClient(clientDto)
activate CTRL

CTRL -> COMP : clientStore = getClientStore()
activate COMP
deactivate COMP
CTRL -> TDTO : citizenCardNumber = getCitizenCardNumber()
activate TDTO
deactivate TDTO

deactivate CTRL
UI ->  CTRL : listOfTypeOfTests = getTypeOfTestList()
activate CTRL


CTRL -> CALDTO : laboratoryID = getLaboratoryID()
activate CALDTO
deactivate CALDTO
CTRL -> COMP : clinicalAnalysisLaboratoryStore = getClinicalAnalysisLaboratoryStore()
activate COMP
deactivate COMP

deactivate TSTORE
deactivate TEST



CTRL -> COMP : testTypeStore = getTestTypeStore()
activate COMP
deactivate COMP
CTRL -> CSTORE : client = getClientThroughCitizenCardNumber(citizenCardNumber)
activate CSTORE
deactivate CSTORE
CTRL -> CALS : typeOfTestList = getTypeOfTestListThroughLaboratoryID(laboratoryID)
activate CALS
deactivate CALS
CTRL -> TMAPPER : toDTO(testTypeList)

activate TMAPPER


TMAPPER --> CTRL : listTestTypeDto
deactivate TMAPPER
CTRL --> UI : listTestTypeDto
deactivate CTRL
UI --> REC: Shows type of test list
deactivate CTRL
deactivate UI

REC -> UI : Selects a type of test
activate UI

UI -> CTRL : addTypeOfTest(typeOfTest)
activate CTRL
activate TTSTORE

deactivate CTRL

UI -> CTRL : parameterList = getParameter()
activate CTRL

deactivate TSTORE
deactivate TEST

CTRL -> TTSTORE : typeOfTest = getTypeOfTest(typeOfTest)

CTRL -> TTSTORE : categoryList = getCategoryListByTheTypeOfTest(typeOfTest))
deactivate TTSTORE


CTRL -> PMAPPER** : toDTO(categoryList)
activate PMAPPER




PMAPPER --> CTRL : listParameterDto
deactivate PMAPPER
CTRL --> UI : listParameterDto
deactivate CTRL
UI --> REC : Shows parameter list
deactivate UI

REC -> UI :  Selects a parameter category
activate UI
UI -> CTRL : createTest(pc)
activate CTRL
CTRL -> COMP : testStore = getTestStore()
activate COMP
CTRL -> COMP : parameterStore = getParameterStore()

deactivate COMP
CTRL -> PSTORE : parameterList = getParameterListByTheCategory(category)
activate PSTORE
deactivate PSTORE
CTRL -> TSTORE : test = createTest(client, typeOfTest, parameter)

activate TSTORE
  TSTORE -> TEST** : create(client, typeOfTest, parameter)
  activate TEST
  TEST -> TDTO : nhsCode = getNhsCode()
  activate TDTO
  TEST -> TDTO : clientName  = getClientName()
  TEST -> TDTO : typeOfTest = getTypeOfTest()
  TEST -> TDTO : parameterList = getParameterList()
  TEST -> TDTO : createdAt = getCreatedAt()
  deactivate TDTO

deactivate TEST


deactivate TSTORE
  CTRL -> TSTORE : validateTest(test)
activate TSTORE
deactivate TSTORE
deactivate CTRL



UI --> REC : Shows all data and requests confirmation
deactivate UI
deactivate CTRL
  REC -> UI : Confirms the data
activate UI
  UI -> CTRL : saveTest()
activate CTRL


  CTRL -> TSTORE : saveTest(test)


  activate TSTORE
  TSTORE -> TSTORE : validateTest(test)
  TSTORE -> TSTORE : addTest(test)

  TSTORE --> CTRL : test added
  CTRL --> UI : result

deactivate TSTORE

deactivate CTRL

UI --> REC : Informs operation success
deactivate COMP
deactivate CTRL
deactivate UI
deactivate REC
deactivate TTSTORE
@enduml




